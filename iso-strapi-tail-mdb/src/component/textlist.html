<template language="js-template">

  <div class="wrapper textlist">
    <div class="Rtable Rtable--5cols Rtable--collapse">

      <div class="Rtable-row Rtable-row--head">
        <div class="Rtable-cell date-cell column-heading">Von</div>
        <div class="Rtable-cell topic-cell column-heading">Auftrag</div>
        <div class="Rtable-cell access-link-cell column-heading">Anzahl</div>
        <div class="Rtable-cell replay-link-cell column-heading">Bezahlung</div>
        <div class="Rtable-cell pdf-cell column-heading">Ansehen</div>
      </div>

      <div class="tlist" data-name="/$textlist/items" data-view="text" data-type="list">

      </div>

    </div>
  </div>

</template>

<style language="scss" scope=".textlist">
  $breakpoint: 750px;
  $heading-color: #43BAC0;

  * {
    box-sizing: border-box;
  }

  .tlist{
    display: contents;
  }

  .wrapper {
    width: 100%;
    max-width: 1000px;
    margin: 1em auto;
    padding: 1em;
  }

  .is-striped {
    background-color: rgba(233, 200, 147, 0.2)
  }


  /* Table column sizing
================================== */
  .date-cell {
    width: 20%;
  }

  .topic-cell {
    width: 41%;
  }

  .access-link-cell {
    width: 13%;
  }

  .replay-link-cell {
    width: 13%;
  }

  .pdf-cell {
    width: 13%;
  }

  /* Apply styles
================================== */
  .Rtable {
    display: flex;
    flex-wrap: wrap;
    margin: 0 0 3em 0;
    padding: 0;
    box-shadow: 0 0 40px rgba(0, 0, 0, 0.2);

    .Rtable-row {
      width: 100%;
      display: flex;

      .Rtable-cell {
        box-sizing: border-box;
        flex-grow: 1;
        padding: 0.8em 1.2em;
        overflow: hidden;  
        list-style: none;

        &.column-heading {
          background-color: $heading-color;
          color: white;
          padding: 1em;
        }

        .Rtable-cell--heading {
          display: none;
        }

        .Rtable-cell--content {
          a {
            font-size: 2em;
            color: #333;
          }

          .webinar-date {
            font-weight: 700;
          }
        }
      }
    }
  }

  /* Responsive
==================================== */
  @media all and (max-width: $breakpoint) {
    .is-striped {
      background-color: white;
    }

    .Rtable--collapse {
      display: block;
      width: 100%;
      padding: 1em;
      box-shadow: none;

      .Rtable-row {
        box-sizing: border-box;
        width: 100%;
        display: flex;
        flex-wrap: wrap;
        margin-bottom: 2em;
        box-shadow: 0 0 40px rgba(0, 0, 0, 0.2);

        .Rtable-cell {
          width: 100% !important;
          display: flex;
          align-items: center;

          .Rtable-cell--heading {
            display: inline-block;
            flex: 1;
            max-width: 120px;
            min-width: 90px;
            color: $heading-color;
            font-weight: 700;
            border-right: 1px solid #ccc;
            margin-right: 1em;
          }

          .Rtable-cell--content {
            flex: 2;
            padding-left: 1em;
          }
        }
      }

      .topic-cell {
        background-color: $heading-color;
        color: white;
        font-weight: 700;
        order: -1;

        .Rtable-cell--content {
          padding-left: 0 !important;
        }
      }

      .Rtable-row--head {
        display: none;
      }
    }
  }

  // Non-Flex modernizer fallback
  .no-flexbox .Rtable {
    display: block;

    &.Rtable-cell {
      width: 100%;
    }
  }
</style>

<script language="js">

  export let textlist = {
    views: {
      "text": function (args) {
        let { change, textlist, _t } = args;
        return `<div class="Rtable-row" data-name="/$textlist/items/${change.value.id}" data-type="list-item"> 
                  <div class="Rtable-cell date-cell">
                    <div class="Rtable-cell--heading">Von</div>
                    <div class="Rtable-cell--content date-content"><span class="webinar-date">${change.value.createdAt.substr(5,14).replace("T"," ")}</div>
                  </div>
                  <div class="Rtable-cell topic-cell">
                    <div class="Rtable-cell--content title-content">${change.value.name}</div>
                  </div>
                  <div class="Rtable-cell access-link-cell">
                    <div class="Rtable-cell--heading">Anzahl</div>
                    <div class="Rtable-cell--content access-link-content">0</div>
                  </div>
                  <div class="Rtable-cell replay-link-cell">
                    <div class="Rtable-cell--heading">Bezahlung</div>
                    <div class="Rtable-cell--content replay-link-content">${change.value.wordcent} cent / Wort</div>
                  </div>
                  <div class="Rtable-cell Rtable-cell--foot pdf-cell">
                    <div class="Rtable-cell--heading">Aktion</div>
                    <div class="Rtable-cell--content pdf-content"><i>start</i></div>
                  </div> 
              </div>`;
      }
    },
    loaded(data) { //pipeline after data has been loaded

    },
    data() {
      return this.createStore("textlist", {
        items: [
          {
            "i": 0,
            "sourcetype": null,
            "_id": "6065fc7327b6b3004e467327",
            "name": "Business Profile schreiben",
            "briefing": "Lieber Autor, \n\nin diesem Job sollen wir Unternehmenstexte ",
            "published_at": "2021-04-01T17:02:06.913Z",
            "createdAt": "2021-04-01T17:01:39.499Z",
            "updatedAt": "2021-04-01T17:03:47.781Z",
            "__v": 0,
            "wordcent": 2.3,
            "input": null,
            "output": null,
            "contents": [
              {
                "versions": [],
                "_id": "6065ffd3d65ede005e7cf9af",
                "data": null,
                "briefing": "Bitte schreibe mir einen kurzen Text",
                "published_at": "2021-04-01T17:16:04.992Z",
                "createdAt": "2021-04-01T17:16:03.151Z",
                "updatedAt": "2021-04-01T17:57:46.295Z",
                "__v": 0,
                "project": "6065fc7327b6b3004e467327",
                "title": "sdsdd",
                "id": "6065ffd3d65ede005e7cf9af"
              },
              {
                "versions": [],
                "_id": "60660024d65ede005e7cf9b0",
                "data": null,
                "briefing": "Bitte schreibe mir einen kurzen Text 2 Firma MÃ¼hlhaus",
                "__v": 0,
                "published_at": "2021-04-01T17:17:30.723Z",
                "createdAt": "2021-04-01T17:17:24.125Z",
                "updatedAt": "2021-04-01T17:17:30.730Z",
                "project": "6065fc7327b6b3004e467327",
                "id": "60660024d65ede005e7cf9b0"
              }
            ],
            "id": "6065fc7327b6b3004e467327"
          },
        ]
      }).db().find().then(function(res){
        let {data, model} = res;
        model._data.items = data;
        return data;
      });
    },
    interactions: () => ({
      "hamburger": {
        "click"(sender, dataStore) {
          sender.field.$el.classList.toggle("checked");
        }
      }
    })
  }
</script>