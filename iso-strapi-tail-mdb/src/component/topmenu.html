<template language="js-template">
    <navgation>
        <div class="logo"><img src="/img/topmenu/logo64.png" alt="no image" /></div>
        <div class="hamburger" data-events="hamburger:click">
            <div class="hamburg">
                <span class="line"></span>
                <span class="line"></span>
                <span class="line"></span>
            </div>
        </div>
        <ul id="menu">
            <li data-name="/$topmenu/link"><a href="/home" class="${topmenu.isActive('home')}">home</a></li>
            <li data-name="/$topmenu/link"><a href="/form" class="${topmenu.isActive('form')}">form</a></li>
            <li data-name="/$topmenu/link"><a href="/extra" class="${topmenu.isActive('extra')}">extra</a></li>
        </ul>
    </navgation>
</template>

<style language="scss">
    navgation {
        background: #EEE;
        display: flex;
        justify-content: space-between;
    }

    .logo {
        padding: 0.5em;
    }

    .hamburger {
        padding: 0 0.5em;
        font-size: 1.5em;
        line-height: 3em;
        display: flex;
        z-index: 2;
    }

    .hamburg {
        display: block;
        background: #555;
        width: 3.14em;
        height: 2.1em;
        position: relative;
        margin: auto;
        border-radius: 4px;
        transition: border-radius .5s;
    }

    .line {
        position: absolute;
        left: 10px;
        height: 4px;
        width: 55px;
        background: #fff;
        border-radius: 2px;
        display: block;
        transition: 0.5s;
        transform-origin: center;
    }

    .line:nth-child(1) {
        top: 12px;
    }

    .line:nth-child(2) {
        top: 24px;
    }

    .line:nth-child(3) {
        top: 36px;
    }

    .hamburger.checked .line:nth-child(1) {
        transform: translateY(12px) rotate(-45deg);
    }

    .hamburger.checked .line:nth-child(2) {
        opacity: 0;
    }

    .hamburger.checked .line:nth-child(3) {
        transform: translateY(-12px) rotate(45deg);
    }

    #menu {
        position: absolute;
        width: 100%;
        background: #eee;
        display: none;
        list-style-type: none;
    }

    #menu:hover {
        display: block;
    }

    #menu li {
        display: block;
        line-height: 50px;
        text-align: center;
    }

    #menu a.active {
        font-weight: bold;
    }

    .hamburger.checked~#menu,
    .hamburger:hover~#menu {
        display: block;
        padding: 0;
        margin: 0;
        left: 0;
        right: 0;
    }

    @media only screen and (min-width: 768px) {
        .hamburger {
            display: none;
        }

        #menu {
            position: static;
            display: flex;
            background: none;
            clear: none;
            flex: 1;
            justify-content: flex-end;
        }

        #menu:hover {
            display: flex;
        }

        #menu li {
            padding: 0 1em;
        }
    }
</style>

<script language="js">

    export let topmenu = {
         loaded(data) { //pipeline after data has been loaded

            console.log("LOADED TOPMENU", data);
            data._data.isActive = (path) => this.environment.path().split("/")[1] === path ? "active" : "";
        },
        data(data, runtime) {
            return this.createStore("topmenu", {
                link: "runtime.path"
            })
        },
        interactions: () => ({
            "hamburger": {
                "click"(sender, dataStore) {
                    sender.field.$el.classList.toggle("checked");
                }
            },
            "/$topmenu/link": {
                "click"(sender, dataStore) {
                    sender.ev.preventDefault();

                    buildApp.loadPage(sender.field.$el.firstChild.getAttribute("href"), () => {
                        dataStore.link = sender.field.$el.firstChild.getAttribute("href");
                    });

                }
            }
        })
    }
</script>