<template language="js-template">
  <extend-head>
    <title>${_t("Hier kannst du dich einloggen")}</title>
  </extend-head>
  <page>
    <topmenu-component data-name="/$topmenu"></topmenu-component>
    <h1>Hallo from from</h1>
    <section>
      <form>
        <div class="container">
          <div class="item">
            <label for="age">Alter</label>
            <input id="age" type="number" data-name="/$user/age" />

            <label for="birthday">Geburtsdatum</label>
            <input id="birthday" data-name="/$user/birthday" type="date" />

            <label for="bname">Benutzername</label>
            <input id="bname" data-name="/$user/bname" required data-validations="required_validator" />

            <label for="email">E-Mail</label>
            <input id="email" type="email" data-name="/$user/email" required
              data-validations="mail_validator,required_validator" />

            <span data-name="/_state/$user/email" class="msg ${ change.value.msg ? 'error':''}">${ change.value.msg ?
              change.value.msg.map(function(e){return e}) : ""
              }</span>

            <label for="passwd">Passwort</label>
            <input type="password" data-name="/$user/password" id="passwd" required
              pattern="^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*_=+-]).{8,12}$" />
              <div class="button-container">   
                  <button type="submit" data-name="/$user/submit">Anmelden</button>
              </div>
          </div>

          <div class="item biefroest">


          </div>

        </div>
      </form>
    </section>
    <bottommenu-component data-name="/$bottommenu"></bottommenu-component>

  </page>
</template>

<style language="scss">
  [data-name="form"]{

    .container {
        display: flex;
        @media only screen and (max-width: 640px) {
            flex-direction: column;
        }
    }

    .item {
        min-height: 100px;
        flex-grow: 1;
        width: 50%;
        @media only screen and (max-width: 640px) {
            width: 100%;
        }
    }

  }

  .error {
    box-shadow: #f31010 0px 0px 4px 0px;
    border: 1px solid red;
    display: block;
  }

  span.msg {
    position: absolute;
    background-color: lightgoldenrodyellow;
    border: 1px solid lightgray;
    border-radius: 0 10px 10px 10px;
  }

  .biefroest {
    background-image: url("https://mountainmoments.de/wp-content/uploads/2019/04/web_mountainmoments-5-aurora-borealis-fotografieren-J.-Groll-1030x686.jpg");
    background-size: cover;
    background-position-x: center;
    /* background-image: url("img/form/biefroest.jpg");*/
  }
</style>

<script language="js">

  import { magic_form } from '../middleware/magic_form';
  import { mail_validator } from '../middleware/validator/email';
  import { required_validator } from '../middleware/validator/required';

 
  export let form = {
    mounted() {
      console.log("mounted", this);
    },
    components: { 
      "topmenu-component": "topmenu#mainmenu",
      "bottommenu-component": "bottommenu#footermenu"
    },
    data() {
      return this
        .createStore("user", { name: "user login" })
        .addValidations({ mail_validator, required_validator });
    },
    interactions() {
      return magic_form.call(this, {
        "/$user/submit": {
          click(change, state) {
            change.ev.preventDefault();
            alert("SUBMIT");
          }
        },
        "/_state/$user/email/msg": {
          change(change, state) {
            if (!state.isValid) {
              document.querySelector("#email").classList.add("error");
            } else {
              document.querySelector("#email").classList.remove("error");
            }
            console.log(change, state);
          }
        }

      }, "/$user", function (data) {

        console.log("CHANGE PLEASE BACKEND SYNC", data)

      });
    },
    translations() {
      return {};
    }
  }
</script>